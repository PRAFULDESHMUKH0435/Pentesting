import 'package:flutter/material.dart';
import 'package:flutter_spinkit/flutter_spinkit.dart';
import 'package:hive/hive.dart';
import 'package:intl/intl.dart';
import 'package:pentesting/CommonHelper/BusinessLogic.dart';

import '../CommonHelper/SingleMyOrderHistoryContainer.dart';
class OrderHistoryScreen extends StatefulWidget {
  const OrderHistoryScreen({super.key});

  @override
  State<OrderHistoryScreen> createState() => _OrderHistoryScreenState();
}

class _OrderHistoryScreenState extends State<OrderHistoryScreen> {


  BusinessLogic bl = BusinessLogic();


  @override
  Widget build(BuildContext context) {
    bl.GetOrderHistoryList();
    bl.orderhistorylist.clear();
    print("Order History List Length Is ${bl.orderhistorylist.length}");
    return Scaffold(
      appBar: AppBar(
        title: Text("Order History"),
      ),
      body: bl.orderhistorylist.length==0?
      EmptyBox()
          :
      FutureBuilder(
        future: bl.GetOrderHistoryList(),
        builder: (context,snapshot){
          if(snapshot.connectionState == ConnectionState.waiting){
            return SpinKitHourGlass(color: Colors.green);
          }else{
            return  ListView.builder(
                itemCount: bl.orderhistorylist.length,
                itemBuilder: (context,index){
                  return SingleMyOrderHistoryContainer(
                    Date: bl.orderhistorylist[index][0],
                    Total: bl.orderhistorylist[index][1].toString(),
                    Discount: bl.orderhistorylist[index][2].toString(),
                    Payable: bl.orderhistorylist[index][3].toString(),
                    itemslist: bl.orderhistorylist[index][4],
                  );
                });
          }
        },
      ),

    );
  }

  EmptyBox() {
    return Container(
      child: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Image.asset('Assets/Images/basket.png',height: 180,width: 150,),
            SizedBox(height: 10,),
            Text(("No Order History Found "),style: TextStyle(fontSize: 25,fontWeight: FontWeight.bold),)
          ],
        ),
      ),
    );
  }
}
