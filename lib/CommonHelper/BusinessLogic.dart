import 'dart:convert';
import 'package:flutter/services.dart';
import 'package:hive/hive.dart';
import 'package:pentesting/CommonHelper/UserRegistrationModel.dart';
import 'package:pentesting/Models/ItemsModel.dart';
import 'package:shared_preferences/shared_preferences.dart';

class BusinessLogic {

  List fruitslist = [];
  List vegetableslist = [];
  List  userdatalist=[];

  void SaveUserDataToSharedPrefernces(UserRegsitrationModel usermodel) async{
     final sp = await SharedPreferences.getInstance();
     sp.setStringList("userdata", [usermodel.username,usermodel.useremail,usermodel.userphone,usermodel.useraddress,usermodel.userpassword]);
     print("User Data Is : ${usermodel.username}\n ,${usermodel.useremail}\n,${usermodel.userphone}\n,${usermodel.useraddress}\n,${usermodel.userpassword}");
  }


   Future LoadData(String path) async{
    final fruitsbox = await Hive.box("FruitsItemsBox");
    final vegetablebox = await Hive.box("VegetableItemsBox");

    fruitslist = fruitsbox.toMap().values.toList();
    vegetableslist = vegetablebox.toMap().values.toList();
    print("Initial fruitslist length is ${fruitslist.length} and Initial vegetableslist is ${vegetableslist.length}");
    if(fruitslist.isNotEmpty && vegetableslist.isNotEmpty){
      return;
    }

   try{
     final  response =await rootBundle.loadString(path);
     var data =await jsonDecode(response);
     for(Map<String,dynamic> i in data){
           ItemsModel im = new ItemsModel(
             productname:i['productname'].toString(),
             productimage: i['productimage'].toString(),
             productprice: i['productprice'].toString(),
             productdescription: i['productdescription'].toString(),
           );
           if(path=="Assets/Json/Fruits.json"){
             fruitslist.add([im.productname,im.productimage,im.productprice,im.productdescription]);
             fruitsbox.add([im.productname,im.productimage,im.productprice,im.productdescription]);
             print("FruitsList LENGTH IS ${fruitslist.length}  And Items Are ${fruitslist}");
           }else{
             vegetableslist.add([im.productname,im.productimage,im.productprice,im.productdescription]);
             vegetablebox.add([im.productname,im.productimage,im.productprice,im.productdescription]);
             print("VegetablesList LENGTH IS ${vegetableslist.length}  And Items Are ${vegetableslist}");
           }
     }
     // var box =await Hive.openBox("ItemsBox");
   }catch(e){
     print("EXCEPTION CAUGHT :${e.toString()}");
   }

    fruitslist = fruitsbox.toMap().values.toList();
    vegetableslist = vegetablebox.toMap().values.toList();
    print("Final fruitslist length is ${fruitslist.length} and Final  vegetableslist is ${vegetableslist.length}");
  }






}